mkdir mon-infra && cd mon-infra

[k3s_cluster]
mon_serveur ansible_host=IP_DE_TON_SERVEUR ansible_user=root

# Si tu n'utilises pas root mais un user 'ubuntu' ou 'debian', change ansible_user
# Si ta clé SSH n'est pas celle par défaut, ajoute: ansible_ssh_private_key_file=~/.ssh/ta_cle

ansible-playbook -i inventory.ini install-k3s.yml

# mon accèss server:  ssh -i ~/.ssh/ovhserver-key ubuntu@151.80.232.74

sudo kubectl get nodes

#Configuer ubuntu comme proprio de kube en Configuer

# 1. Créer le dossier de config caché s'il n'existe pas
mkdir -p ~/.kube

# 2. Copier le fichier de config admin de K3s vers ton dossier utilisateur
sudo cp /etc/rancher/k3s/k3s.yaml ~/.kube/config

# 3. Te donner la propriété de ce fichier (remplace 'ubuntu' si ton user est différent)
sudo chown ubuntu:ubuntu ~/.kube/config

# 4. Ajuster les permissions pour que seul toi puisse le lire
chmod 600 ~/.kube/config

Forcer le chemin (Le Fix)
Pour être sûr que ton système regarde le bon fichier, on va définir la variable d'environnement explicitement.

Bash

export KUBECONFIG=~/.kube/config

# on ajoute cette variable à mon profile pour la persistance 
echo 'export KUBECONFIG=~/.kube/config' >> ~/.bashrc
source ~/.bashrc


kubectl create namespace argocd
Registrty github

docker tag my-collector:v2 ghrc.io/mtk14m/ops-dashboard-collector:v0.1.0 

# On force l'architecture linux/amd64 et on push directement
docker buildx build --platform linux/amd64 -t ghcr.io/mtk14m/ops-dashboard-collector:v0.1.0 --push .

# Recupérer l'image docker qui tourne sur un pod
kubectl get pods -l app=collector -o yaml | grep image:  
kubectl get pods -l app=collector -o jsonpath="{.items[*].spec.containers[*].image}"

# Generer le mp argocd 
kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d; echo

# Mise en place des alert discord 
#Crétion du secret webhook discord
kubectl create secret generic discord-webhook-secret \
  --from-literal=url="https://discord.com/api/webhooks/TON_URL_ICI" \
  -n monitoring


#forward les ports argocd, graphana et prometheus 
kubectl port-forward svc/argocd-server -n argocd 8080:443

kubectl port-forward svc/prometheus-operated -n monitoring 9090:9090

kubectl port-forward svc/monitoring-stack-grafana -n monitoring 3000:80

 kubectl port-forward svc/alertmanager-operated -n monitoring 9093:9093


 Blog: 

 Backend: 
 poetry init --name "portfolio-backend" --description "API Backend Portfolio SRE" --author "TonNom <ton@email.com>" --python "^3.10"

 # Framework & Serveur
poetry add fastapi uvicorn[standard]

# Base de données & ORM
poetry add sqlalchemy psycopg2-binary alembic

# Settings & Validation
poetry add pydantic-settings email-validator python-multipart

# Monitoring (Indispensable pour notre projet SRE)
poetry add prometheus-fastapi-instrumentator
